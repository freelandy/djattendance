{% extends 'base.html' %}
{% load staticfiles %}

{% block title %}
  {{title}}
{% endblock %}

{% block scripts %}
{{ block.super }}
<script type="text/javascript">

var table;

$(document).ready(function() {

  setdatatable();

  $( "body" ).on('click', '#generate_table', function(){
    generate();
  });

  $("body").on('click', 'span.glyphicon',function(){
    var state_tobe;

    if ($(this).attr('class') == 'glyphicon glyphicon-ok-circle'){
      $(this).attr('class', 'glyphicon glyphicon-remove-circle')
      $(this).attr('style', 'color:red')
      state_tobe = false
    }else if($(this).attr('class') == 'glyphicon glyphicon-remove-circle'){
      $(this).attr('class', 'glyphicon glyphicon-ok-circle')
      $(this).attr('style', 'color:green')
      state_tobe = true
    }

    var val = $(this).parent().attr('id');

    $.ajax({
      type: "POST",
      url: "{%url 'attendance:audit-rolls' %}",
      data: {id: val,
        state: state_tobe,
        csrfmiddlewaretoken: '{{ csrf_token }}'},
        success: function(response){
          new Notification(Notification.SUCCESS, 'Saved').show();
        },
      })
  });

});

function setdatatable(){
  table = $("#audittable").DataTable({
    info: true,
    autowidth: true,
    ordering: true,
    paging: false,
    order: [],
    buttons: [
      {
        extend: 'print',
        text: 'Print',
        autoPrint: true,
        exportOptions:{
          columns: ':visible'
        },
      },
      {
        extend: 'csvHtml5',
        text: 'CSV',
        exportOptions: {
          columns: ':visible'
        },
      },
      {
        extend: 'pdf',
        text: 'PDF',
        exportOptions:{
          columns: ':visible'
        },
      },
      {
        extend: 'collection',
        buttons: 'columnsVisibility',
        text: 'Show/Hide Columns',
        columns: ':gt(1)',
      },
      ],
  });
}

</script>
{% endblock %}

{% block references %}
{{ block.super }}

<meta name="viewport" content="width=device-width, user-scalable=no">
<style type="text/css">

#gender{
  display:inline-block;
  margin-right:10px;
  margin-top: 10px;
  margin-bottom: 10px
}

#period{
  display:inline-block;
  margin-right:10px;
}

#generate_table{
  display:inline-block;
}

</style>
{% endblock %}

{% block content %}

<h2>{{title}}</h2>

<table id="audittable" class="table table-striped table-bordered">
  <thead>
    <tr>
      <th>On Self-Attendance</th>
      <th>Trainee</th>
      <th>Mismatched Frequencies</th>
      <th>A/T Discrepancy</th>
      <th>Rolls Detail - Text</th>
    </tr>
  </thead>
  <tbody id="tablebody">
    {% for id, record in audit_log.items %}
    <tr>
      <td id="{{id}}">
        {% if record.self_attendance == True %}
        <span class="glyphicon glyphicon-ok-circle" style="color:green" title="On Self-Attendance"></span>
        {% elif record.self_attendance == False %}
        <span class="glyphicon glyphicon-remove-circle" style="color:red" title="Not On Self-Attendance"></span>
        {% endif %}
        <div hidden>{{record.self_attendance}}</div>
      </td>
      <td>{{record.name}}</td>
      <td>{{record.mismatch}}</td>
      <td>{{record.AT_discrepancy}}</td>
      <td>
      {% for period in record.details %}
        {{ record.details|get_index:period }}
      {% empty %}

      {% endfor %}
      </td>
  </tr>
  {% endfor %}
</tbody>
</table>

{% endblock %}