{% extends "base.html" %}
{% load staticfiles %}
{% load bootstrap3 %}
{% load common_tags %}
{% load render_bundle from webpack_loader %}

{% block title %}{{page_title}}{% endblock %}

{% block scripts %}
<script type="text/javascript">
  var AIRPORT_CODES = {{AIRPORT_CODES|safe}};
  var AIRLINE_CODES = {{AIRLINE_CODES|safe}};
  $(document).ready(function() {
    $(".airport-field").bind("input propertychange", function(){
      let check = AIRPORT_CODES.includes($(this).val());
      if (!check){
        $(this).css('border-color', 'red');
      }
      else {
        $(this).css('border-color', '');
      }
    });
    $(".airline-field").bind("input propertychange", function(){
      let check = AIRLINE_CODES.includes($(this).val());
      if (!check){
        $(this).css('border-color', 'red');
      }
      else {
        $(this).css('border-color', '');
      }
    });
    $("[required]").parent().children("label").append(" *").css("color", "red");
  });

</script>
{% endblock %}

{% block content %}
<h2>{{page_title}}</h2>
{% if preview %}
<h3>Preview for: {{preview}}</h3>
{% endif %}
<!-- Navigation Display -->
<ul class="nav nav-tabs">
  {% for section in section_qs %}
    <li {% if forloop.first %}class="active"{% endif %}>
      <a data-toggle="tab" href="#section_{{forloop.counter}}">{{section.name}}</a>
    </li>
  {% endfor %}
</ul>
<!-- Navigation Display -->
<form action="" method="post">
  {% csrf_token %}
  <div class="tab-content">
    {% for section in section_qs %}
    <div id="section_{{forloop.counter}}" class="tab-pane fade {% if forloop.first %}in active {% endif %}">
    <div class="panel">
      <h3>{{section.name}}</h3>
      {% for question in section.question_set.all %}
        {% if question.label %}<p><strong>{{question.label}}</strong></p>{% endif %}
        <p>{{question.instruction|safe}}</p>
        {%for form in answer_forms %}
          {% if form.prefix == question.id %}
            {% bootstrap_form form %}
            {{form.media}}
          {% endif %}
        {% endfor %}
      {% endfor %}
    </div><!-- panel -->
    </div><!-- tab-pane -->
    {% endfor%}
  </div><!-- tab-content -->
  <div class="row">
    <div class="col-md-12">
      <button type="submit" class="btn btn-primary btn-save">Submit</button>
      {% if preview %}
      <a href="{% url 'gospel_trips:admin-update' pk %}"><button type="button" class="btn btn-primary" title="Edit"><span class="glyphicon glyphicon-pencil"></span></button></a>
      <a href="{% url 'gospel_trips:admin-create' %}"><button type="button" class="btn btn-primary" title="Preview"><span class="glyphicon glyphicon-home"></span></button></a>
      {% endif %}
    </div>
  </div>
</form>
{% endblock %}
